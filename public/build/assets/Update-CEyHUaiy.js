import{d as v,T as D,l as p,k as L,q as T,c as j,w,o as i,a as e,g as d,e as s,f as u,n as H,h as N,F as A,t as f,u as F,i as J,y as M}from"./app-DoPaJPuH.js";import{S as m}from"./sweetalert2.esm.all-D3pEHXw3.js";import{_ as z}from"./AppLayout-DgNSrLQi.js";const E={class:"flex","aria-label":"Breadcrumb"},R={class:"inline-flex items-center space-x-1 md:space-x-3"},U={class:"inline-flex items-center"},V=["href"],q={class:"flex items-center"},O=["href"],Z={class:"py-12"},$={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},I={class:"bg-white overflow-hidden sm:rounded-lg shadow-lg"},Y={class:"flex justify-between items-center px-6 py-4 bg-gray-100 border-b"},G={class:"relative"},Q={key:0,class:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10"},W=["href"],X=["href"],ee=["href"],ae=["href"],te=["href"],ne=["href"],ie=["href"],se={class:"p-6 space-y-6"},le={key:0,class:"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-4"},re={key:1,class:"bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 mb-4"},oe={class:"space-y-4"},ue={class:"flex justify-between items-center mb-4"},de=["href"],me={key:1,class:"font-semibold text-gray-700"},ke={class:"flex space-x-2"},ce=["onClick"],pe={key:0,class:"bg-red-50 border border-red-200 text-red-600 rounded px-3 py-2 mb-2"},he={key:1,class:"mt-4"},ge=["for"],fe=["id"],be={key:0,class:"text-gray-500 text-center py-8"},xe={class:"flex items-center mt-6"},Be={__name:"Update",props:{documents:Array,applicant:Object,auth:Object},setup(o){const l=o,b=v(l.documents||[]),r=D({id:null,nama_dokumen:"",file_dokument:null}),h=v(!1),_=t=>{r.id=t.id,r.nama_dokumen=t.nama_dokumen,r.file_dokument=null,M(()=>{const a=t.getElementById("file_dokument_"+t.id);a&&(a.value="")})};function B(t){const a=t.target.files[0];if(a&&a.size>10*1024*1024){alert("Saiz fail melebihi 10MB. Sila pilih fail yang lebih kecil."),t.target.value="";return}r.file_dokument=a}const S=()=>{h.value=!h.value},P=()=>{if(!r.file_dokument){m.fire("Ralat!","Sila pilih fail PDF untuk dimuat naik.","error");return}r.submit("post",route("dokumen.update",r.id),{onSuccess:()=>{m.fire({icon:"success",title:"Berjaya!",text:"Dokumen berjaya dikemaskini."}).then(()=>{window.location.reload()})},onError:()=>{m.fire("Ralat!","Terdapat masalah semasa mengemaskini fail.","error")},forceFormData:!0})};p(()=>{var n;const t=(n=l.auth)==null?void 0:n.user,a=l.applicant;return!t||t.role.toLowerCase()!=="kerani"?!0:a&&(a.status==="Borang Tidak Lengkap"||a.status==="Perbaharui Lesen")});const c=p(()=>{var t,a,n;return((n=(a=(t=l.auth)==null?void 0:t.user)==null?void 0:a.role)==null?void 0:n.toLowerCase())==="kerani"&&l.applicant.status==="Perbaharui Lesen"}),g=p(()=>{var t,a,n;return((n=(a=(t=l.auth)==null?void 0:t.user)==null?void 0:a.role)==null?void 0:n.toLowerCase())==="kerani"&&l.applicant.status==="Borang Tidak Lengkap"}),k=p(()=>l.applicant.status==="Dalam Semakan"||l.applicant.status==="Dalam Proses Semakan"),C=()=>{m.fire({title:"Sahkan Selesai Perbaharui Lesen?",html:"Adakah anda sudah mengemaskini semua maklumat? <br><b>Jika belum, sila gunakan 'Pilih Halaman' untuk kemaskini.</b><br><br><span class='text-red-600'>Jika anda keluar dari halaman tanpa klik 'Kemaskini', perubahan tidak akan disimpan.</span>",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Selesai & Hantar",cancelButtonText:"Batal"}).then(t=>{t.isConfirmed&&axios.post(route("renew.complete",l.applicant.id)).then(()=>{m.fire("Berjaya!","Permohonan telah dihantar untuk semakan.","success").then(()=>window.location.href=route("applicant.index"))})})},K=()=>{m.fire({title:"Sahkan Simpan Kemaskini?",html:"Adakah anda sudah mengemaskini semua maklumat? <br><b>Jika belum, sila gunakan 'Pilih Halaman' untuk kemaskini.</b><br><br><span class='text-red-600'>Jika anda keluar dari halaman tanpa klik 'Kemaskini', perubahan tidak akan disimpan.</span>",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Simpan & Hantar",cancelButtonText:"Batal"}).then(t=>{t.isConfirmed&&axios.post(route("renew.complete",l.applicant.id)).then(()=>{m.fire("Berjaya!","Permohonan telah dihantar untuk semakan.","success").then(()=>window.location.href=route("applicant.index"))})})};let x=!1;L(r,()=>{c.value&&(x=!0)},{deep:!0});const y=t=>{if(c.value&&x)return t.preventDefault(),t.returnValue="",""};return typeof window<"u"&&(window.addEventListener("beforeunload",y),T(()=>window.removeEventListener("beforeunload",y))),(t,a)=>(i(),j(z,{title:"Kemaskini Pemohonan"},{header:w(()=>[a[3]||(a[3]=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Kemaskini Pemohonan ",-1)),a[4]||(a[4]=e("br",null,null,-1)),e("nav",E,[e("ol",R,[e("li",U,[e("a",{href:t.route("dashboard"),class:"inline-flex items-center text-sm font-medium text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"},a[0]||(a[0]=[e("svg",{class:"w-3 h-3 me-2.5","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"m19.707 9.293-2-2-7-7a1 1 0 0 0-1.414 0l-7 7-2 2a1 1 0 0 0 1.414 1.414L2 10.414V18a2 2 0 0 0 2 2h3a1 1 0 0 0 1-1v-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h3a2 2 0 0 0 2-2v-7.586l.293.293a1 1 0 0 0 1.414-1.414Z"})],-1),d(" Home ")]),8,V)]),e("li",null,[e("div",q,[a[1]||(a[1]=e("svg",{class:"w-6 h-6 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M7.293 14.707a1 1 0 0 1 0-1.414L10.586 10 7.293 6.707a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414 0Z"})],-1)),e("a",{href:t.route("applicant.index"),class:"ml-1 text-sm font-medium text-gray-700 hover:text-gray-900 md:ml-2 dark:text-gray-400 dark:hover:text-white"},"Senarai Pemohon",8,O)])]),a[2]||(a[2]=e("li",{"aria-current":"page"},[e("div",{class:"flex items-center"},[e("svg",{class:"w-6 h-6 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M7.293 14.707a1 1 0 0 1 0-1.414L10.586 10 7.293 6.707a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414 0Z"})]),e("span",{class:"ml-1 text-sm font-medium text-gray-500 md:ml-2 dark:text-gray-400"},"Kemaskini Pemohonan")])],-1))])])]),default:w(()=>[e("div",Z,[e("div",$,[e("div",I,[e("div",Y,[a[7]||(a[7]=e("h3",{class:"text-lg font-semibold text-gray-700"},"Kemaskini Dokumen Sokongan",-1)),e("div",G,[e("button",{onClick:S,class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 focus:outline-none"}," Pilih Halaman "),h.value?(i(),s("div",Q,[e("a",{href:t.route("applicant.edit",o.applicant.id),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Butiran Pemohon ",8,W),e("a",{href:t.route("pengusaha.edit",o.applicant.id),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Butiran Pengusaha ",8,X),e("a",{href:t.route("butirantaska.edit",o.applicant.id),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Butiran Taman Asuhan Kanak-Kanak ",8,ee),a[5]||(a[5]=e("a",{href:"#",class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Bilangan Kanak-Kanak ",-1)),a[6]||(a[6]=e("a",{href:"#",class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Butiran Bayaran Kanak ",-1)),e("a",{href:t.route("butiranpengurus.edit",o.applicant.id),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Butiran Pengurus ",8,ae),e("a",{href:t.route("butiranpenyelia.edit",o.applicant.id),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Butiran Penyelia ",8,te),e("a",{href:t.route("maklumatpekerja.edit",o.applicant.id),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Maklumat Pekerja ",8,ne),e("a",{href:t.route("dokumen.edit",o.applicant.id),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Dokumen Sokongan ",8,ie)])):u("",!0)])]),e("div",se,[c.value&&!k.value||g.value&&!k.value?(i(),s("div",le,a[8]||(a[8]=[e("b",null,"Perhatian:",-1),d(" Sila pastikan anda klik "),e("b",null,"Kemaskini",-1),d(" untuk menyimpan perubahan. Jika anda keluar dari halaman atau ke halaman lain tanpa klik "),e("b",null,"Kemaskini",-1),d(", perubahan anda tidak akan disimpan."),e("br",null,null,-1),d(" Jika ada maklumat lain perlu dikemaskini, gunakan "),e("b",null,"Pilih Halaman",-1),d(" di atas. ")]))):u("",!0),k.value?(i(),s("div",re," Permohonan sedang dalam proses semakan. Anda tidak boleh lagi mengemaskini maklumat. ")):u("",!0),e("div",{class:H(["bg-gray-50 p-4 rounded-lg shadow-sm",{"pointer-events-none opacity-60":k.value}])},[a[12]||(a[12]=e("h4",{class:"text-md font-medium text-gray-700 mb-4"},"Senarai dan Kemaskini Dokumen",-1)),e("ul",oe,[(i(!0),s(A,null,N(b.value,n=>(i(),s("li",{key:n.id,class:"border rounded-lg p-4 bg-white shadow-sm"},[e("div",ue,[n.file_dokument?(i(),s("a",{key:0,href:`/storage/${n.file_dokument}`,target:"_blank",class:"text-blue-500 hover:underline"},f(n.nama_dokumen||"Tanpa Nama Dokumen"),9,de)):(i(),s("span",me,f(n.nama_dokumen||"Tanpa Nama Dokumen"),1)),e("div",ke,[e("button",{onClick:ye=>_(n),class:"text-sm text-blue-500 hover:underline"}," Kemaskini ",8,ce)])]),!n.file_dokument&&(c.value||g.value)?(i(),s("div",pe,[a[9]||(a[9]=d(" Dokumen tidak dijumpai. Nama fail: ")),e("b",null,f(n.nama_dokumen||"Tanpa Nama Dokumen"),1)])):u("",!0),F(r).id===n.id?(i(),s("div",he,[e("form",{onSubmit:J(P,["prevent"]),class:"space-y-4"},[e("div",null,[e("label",{for:"file_dokument_"+n.id,class:"block text-sm font-medium text-gray-700"}," Fail Dokumen ",8,ge),e("input",{onChange:B,type:"file",id:"file_dokument_"+n.id,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"},null,40,fe),a[10]||(a[10]=e("p",{class:"mt-2 text-xs text-gray-500"}," Hanya fail PDF dibenarkan. Saiz fail maksimum: 10MB. ",-1))]),a[11]||(a[11]=e("div",{class:"flex justify-end"},[e("button",{type:"submit",class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 focus:ring-4 focus:ring-blue-300"}," Simpan ")],-1))],32)])):u("",!0)]))),128))]),b.value.length===0?(i(),s("div",be," Tiada dokumen untuk dikemaskini. ")):u("",!0),e("div",xe,[c.value&&!k.value?(i(),s("button",{key:0,type:"button",class:"ml-auto text-white bg-green-600 hover:bg-green-700 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center",onClick:C}," Selesai Perbaharui Lesen ")):u("",!0),g.value&&!k.value?(i(),s("button",{key:1,type:"button",class:"ml-auto text-white bg-green-600 hover:bg-green-700 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center",onClick:K}," Simpan Kemaskini ")):u("",!0)])],2)])])])])]),_:1}))}};export{Be as default};
